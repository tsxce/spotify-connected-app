(function(){"use strict";const l={user:"v1/me",topTracks:"v1/me/top/tracks",topArtists:"v1/me/top/artists",recentPlay:"v1/me/player/recently-played?limit=49",myPlaylists:"v1/me/playlists",getTrack:"v1/tracks/",getTrackFeature:"v1/audio-features/",getArtist:"v1/artists/"};async function i(m,n,a,c){return await await(await fetch(`https://api.spotify.com/${n}`,{headers:{Authorization:`Bearer ${m}`},method:a,body:JSON.stringify(c)})).json()}onmessage=async m=>{const n=m.data;if(n.type==="token"){const a=n.payload,c=await i(a,l.topTracks,"GET"),s={};console.log("responseTop workerjs: ",c);const p=c.items.map(o=>i(a,l.getTrackFeature+o.id,"GET").then(e=>{console.log("worker: ",e),e.error?console.error("API 请求失败"):Object.keys(e).forEach(t=>{console.log("key: ",t),e[t]>0&&e[t]<1&&(s.key?s[t]=s[t]+e[t]:s[t]=e[t])})}));Promise.all(p).then(()=>{Object.keys(s).forEach(o=>{s[o]=s[o]/c.items.length}),postMessage({type:"top success",payload:s})}).catch(o=>{console.error("Promise.all错误: ",o)});const f=await i(a,l.recentPlay,"GET"),r={};console.log("responseTop workerjs: ",c);const u=f.items.map(o=>i(a,l.getTrackFeature+o.track.id,"GET").then(e=>{console.log(e),e.error?console.error("API 请求失败"):Object.keys(e).forEach(t=>{console.log("key: ",t),e[t]>0&&e[t]<1&&(r.key?r[t]=r[t]+e[t]:r[t]=e[t])})}));Promise.all(u).then(()=>{Object.keys(r).forEach(o=>{r[o]=r[o]/f.items.length}),postMessage({type:"recent success",payload:r})}).catch(o=>{console.error("Promise.all错误: ",o)})}}})();
